---
import BaseLayout from './BaseLayout.astro';
import { Image } from 'astro:assets';
import Tags from '../components/posts/Tags.astro';
import { getReadingTime } from '../utils/reading-time';
import ImageModal from '../components/ImageModal.astro';

const { frontmatter, currentLang, originalPost } = Astro.props;
const pageTitle = frontmatter.title;

// Get the content as a string for reading time calculation
const content = await Astro.slots.render('default');
const readingTime = getReadingTime(content);

// Pass language info to BaseLayout
const i18nData = {
  currentLang,
  originalPost: originalPost ? `/posts/${originalPost.slug.split('/').slice(1).join('/')}` : frontmatter.originalLink,
};
---

<BaseLayout pageTitle={pageTitle} i18nData={i18nData}>
  <article class="post">
    <header class="post-header">
      <div class="post-meta">
        <time datetime={frontmatter.pubDate.toISOString()}>
          {
            new Date(frontmatter.pubDate).toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
            })
          }
        </time>
        <span class="reading-time">{readingTime} min read ☕️</span>
      </div>
      <p class="description"><em>{frontmatter.description}</em></p>
      <Tags tags={frontmatter.tags} />
    </header>

    {
      frontmatter.image && (
        <div class="featured-image-container">
          <Image
            src={frontmatter.image.url}
            alt={frontmatter.image.alt}
            width={1200}
            height={450}
            class="featured-image"
            quality="max"
            densities={[1, 2]}
          />
        </div>
      )
    }

    <div class="post-content">
      <slot />
    </div>

    <footer class="post-footer">
      <p>Written by {frontmatter.author}</p>
    </footer>
  </article>
</BaseLayout>

<ImageModal />

<style>
  .post-header {
    margin-bottom: var(--space-xl);
  }

  .post-meta {
    display: flex;
    gap: var(--space-md);
    color: var(--color-text);
    font-size: 0.9rem;
    margin-bottom: var(--space-md);
  }

  .reading-time {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
  }

  .reading-time::before {
    content: '•';
    margin-right: var(--space-xs);
  }

  .description {
    font-size: 1.1rem;
    line-height: 1.6;
    margin: var(--space-md) 0;
  }

  .featured-image-container {
    width: 100vw;
    transform: translateX(-50%);
    max-width: var(--container-max-width);
    margin: var(--space-xl) 0 var(--space-xl) 50%;
  }

  .featured-image {
    width: 100%;
    height: 450px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    object-fit: cover;
  }

  .post-content {
    margin-top: var(--space-xl);
  }

  .post-content :global(img) {
    max-width: 100%;
    max-height: 450px;
    object-fit: contain;
    height: auto;
    display: block;
    margin: var(--space-md) auto;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease-in-out;
  }

  .post-content :global(img:hover) {
    transform: scale(1.01);
  }

  .post-footer {
    margin-top: var(--space-xl);
    padding-top: var(--space-lg);
    font-style: italic;
  }
</style>
