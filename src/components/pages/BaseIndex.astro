---
import { Image } from 'astro:assets';
import GitHubCommits from '../GitHubCommits.astro';
import profilePic from '../../assets/alepro.png';
import { getGitHubCommitsData } from '../../utils/github';
import type { SupportedLanguage } from '../../types/i18n';

export interface HomepageTranslations {
    pageTitle: string;
    pageDescription: string;
    tagline: string;
    intro: string;
    readMore: string;
    readMoreLink: string;
    stayUpdated: string;
    followTwitter: string;
    subscribeRss: string;
    needHelp: string;
    letsTalk: string;
    profilePicAlt: string;
}

export const homeTranslations: Record<SupportedLanguage, HomepageTranslations> = {
    en: {
        pageTitle: 'Home',
        pageDescription:
            "I'm a Software Engineering Manager addicted to details and obsessed with how things work: from Cloud services to human relationships. Since my first Hello World in RPG Maker, I have come to believe that being an Engineer is much more than coding.",
        tagline: 'Insightful. Precise. Human.',
        intro: "I'm a Software Engineering Manager addicted to details and obsessed with how things work: from Cloud services to human relationships. Since my first Hello World in RPG Maker, I have come to believe that being an Engineer is much more than coding.",
        readMore: 'Wanna know more about me?',
        readMoreLink: 'Read my story.',
        stayUpdated: 'Wanna stay updated?',
        followTwitter: 'Follow @_aleromano',
        subscribeRss: 'subscribe to my RSS feed.',
        needHelp: 'Need help launching your startup, scaling your engineering team, or growing as a software engineer?',
        letsTalk: "Let's talk.",
        profilePicAlt: 'Alessandro Romano profile picture',
    },
    it: {
        pageTitle: 'Home',
        pageDescription:
            'Sono un Engineering Manager ossessionato dai dettagli e da come funzionano le cose: dai servizi Cloud alle relazioni umane. Dal mio primo Hello World in RPG Maker, sono arrivato a credere che essere un Ingegnere sia molto più che programmare.',
        tagline: 'Perspicace. Preciso. Umano.',
        intro: 'Sono un Engineering Manager ossessionato dai dettagli e da come funzionano le cose: dai servizi Cloud alle relazioni umane. Dal mio primo Hello World in RPG Maker, sono arrivato a credere che essere un Ingegnere sia molto più che programmare.',
        readMore: 'Vuoi saperne di più su di me?',
        readMoreLink: 'Leggi la mia storia.',
        stayUpdated: 'Vuoi rimanere aggiornato?',
        followTwitter: 'Segui @_aleromano',
        subscribeRss: 'iscriviti al mio feed RSS.',
        needHelp:
            'Hai bisogno di aiuto per lanciare la tua startup, far crescere il tuo team di ingegneria, o crescere come ingegnere del software?',
        letsTalk: 'Parliamone.',
        profilePicAlt: 'Foto profilo di Alessandro Romano',
    },
};

export function getHomeTranslations(language: SupportedLanguage): HomepageTranslations {
    return homeTranslations[language];
}

interface Props {
    language: SupportedLanguage;
}

const { language } = Astro.props;

// Get translations for the current language
const t = getHomeTranslations(language);

// Fetch GitHub commits data server-side
const githubData = await getGitHubCommitsData(language);
---

<h2>{t.tagline}</h2>

<div class="intro">
    <div class="content">
        <p>
            {t.intro}
        </p>
        <p>
            {t.readMore}
            <a href={language === 'it' ? '/it/about' : '/about'}>{t.readMoreLink}</a>
        </p>
        <p>
            {t.stayUpdated}
            <a href="https://x.com/intent/user?screen_name=_aleromano" target="_blank" rel="noopener noreferrer"
                >{t.followTwitter}</a
            > or <a href="/rss.xml">{t.subscribeRss}</a>
        </p>
        <p>
            {t.needHelp}
            <a href={language === 'it' ? '/it/contact' : '/contact'}>{t.letsTalk}</a>
        </p>
    </div>
    <Image
        src={profilePic}
        alt={t.profilePicAlt}
        width={300}
        priority
        densities={[1, 2]}
        quality="max"
        class="profile-pic"
    />
</div>

<GitHubCommits commits={githubData.commits} error={githubData.error} language={language} />

<style>
    .intro {
        display: flex;
        align-items: center;
        gap: var(--space-md);
        margin: var(--space-lg) 0 0;
    }

    .content {
        flex: 1;
    }

    /* Show/hide based on theme */
    .dark-logo {
        display: none;
    }

    :global([data-theme='dark']) .dark-logo {
        display: inline;
    }

    :global([data-theme='dark']) .light-logo {
        display: none;
    }

    .profile-pic {
        margin-bottom: calc(-1 * var(--space-lg));
        max-width: 100%;
        height: auto;
        transform: translateY(0);
        animation: slideDown 1s ease-out 0.2s backwards;
    }

    @keyframes slideDown {
        from {
            transform: translateY(-25%);
        }
        to {
            transform: translateY(0);
        }
    }

    @media (max-width: 636px) {
        .intro {
            flex-direction: column;
        }

        .profile-pic {
            margin-bottom: -1.2rem;
        }
    }
</style>
