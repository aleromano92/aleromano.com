---
import type { TwitterPost } from '../utils/twitter/twitter';

interface Props {
    post: TwitterPost;
}

type MediaItem = {
    type: 'photo' | 'video' | 'animated_gif';
    url?: string;
    preview_image_url?: string;
    alt_text?: string;
    width?: number;
    height?: number;
};

const { post } = Astro.props;
---

<article class="tweet-card">
    <a href={post.url} target="_blank" rel="noopener noreferrer" class="tweet-link">
        <div class="tweet-header">
            <div class="tweet-author">
                <span class="username">@{post.author_username} ¬∑ </span>
                <time datetime={post.created_at} title={post.formattedDate}>
                    {post.relativeTime}
                </time>
            </div>
        </div>

        <div class="tweet-content">
            <p class="tweet-text">{post.text}</p>

            {
                post.media && post.media.length > 0 && (
                    <div class="tweet-media">
                        {post.media.map((mediaItem: MediaItem) => (
                            <div class="media-item">
                                {mediaItem.type === 'photo' && (
                                    <img
                                        src={mediaItem.url || mediaItem.preview_image_url}
                                        alt={mediaItem.alt_text || 'Image from tweet'}
                                        width={mediaItem.width}
                                        height={mediaItem.height}
                                        loading="lazy"
                                        class="tweet-image"
                                    />
                                )}
                                {mediaItem.type === 'video' && (
                                    <div class="video-placeholder">
                                        <p>üé• Video content</p>
                                    </div>
                                )}
                                {mediaItem.type === 'animated_gif' && (
                                    <div class="gif-placeholder">
                                        <p>üé¨ GIF content</p>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                )
            }
        </div>

        <div class="tweet-metrics">
            <span class="metric">
                üí¨ {post.public_metrics.reply_count}
            </span>
            <span class="metric">
                üîÑ {post.public_metrics.retweet_count}
            </span>
            <span class="metric">
                ‚ù§Ô∏è {post.public_metrics.like_count}
            </span>
        </div>
    </a>
</article>

<style>
    .tweet-card {
        border: 1px solid var(--color-border);
        border-radius: 8px;
        background: white;
        transition:
            transform 0.3s ease,
            box-shadow 0.3s ease,
            border-color 0.2s ease;
        overflow: hidden;
    }

    :global([data-theme='dark']) .tweet-card {
        background: black;
    }

    .tweet-link {
        display: block;
        padding: var(--space-md);
        text-decoration: none;
        color: inherit;
    }

    .tweet-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-color: var(--color-accent);
    }

    .tweet-card:hover .tweet-link {
        text-decoration: none;
    }

    .tweet-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.75rem;
    }

    .tweet-author strong {
        color: var(--color-text);
        margin-right: 0.5rem;
    }

    .username {
        color: var(--color-text);
        font-size: 0.9rem;
        font-weight: 500;
    }

    .tweet-content {
        margin-bottom: 0.75rem;
    }

    .tweet-text {
        color: var(--color-text);
        line-height: 1.5;
        margin: 0 0 1rem 0;
    }

    .tweet-media {
        border-radius: 0.5rem;
        overflow: hidden;
        margin-top: 1rem;
    }

    .media-item {
        margin-bottom: 0.5rem;
    }

    .tweet-image {
        width: 100%;
        height: auto;
        max-height: 400px;
        object-fit: cover;
        border-radius: 0.5rem;
    }

    .video-placeholder,
    .gif-placeholder {
        background: var(--color-secondary);
        border: 2px dashed var(--color-border);
        border-radius: 0.5rem;
        padding: 2rem;
        text-align: center;
        color: var(--color-text-secondary);
    }

    .tweet-metrics {
        display: flex;
        gap: 1rem;
        font-size: 0.9rem;
    }

    .metric {
        color: var(--color-text-secondary);
    }
</style>
